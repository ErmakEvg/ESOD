<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/login.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/insp.css}">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js"></script>
    <title>ЕДИНАЯ СИСТЕМА ОБМЕНА ВЫПЛАТНЫМИ ДОКУМЕНТАМИ</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse"><span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span></button>
                <a class="navbar-brand" href="#"><span>ЕСО</span>ВД</a>
            </div>
        </div>
    </nav>

    <div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
        <div class="profile-sidebar">
            <div class="profile-userpic">
                <img th:src="@{../img/man.png}" class="img-responsive" alt="">
            </div>
            <div class="profile-usertitle">
                <div class="profile-usertitle-name" th:utext="${user.getSurname() + ' ' + user.getFirstname()}"></div>
                <div class="profile-usertitle-status"><span class="indicator label-success"></span>Online</div>
            </div>
            <div class="clear"></div>
        </div>
        <div class="divider"></div>

        <ul class="nav menu">
            <li><a th:href="@{/bank}"><em class="fa fa-home">&nbsp;</em> ГЛАВНАЯ</a></li>
            <li class="active"><a th:href="@{#}"><em class="fa fa-upload">&nbsp;</em> ПРИЕМ ДОКУМЕНТОВ</a></li>
            <li><a th:href="@{/bank/archive}"><em class="fa fa-list-alt">&nbsp;</em> ИСТОРИЯ</a></li>
            <li><a th:href="@{/logout}"><em class="fa fa-power-off">&nbsp;</em> ВЫХОД</a></li>
        </ul>
    </div>


    <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
        <div class="row">
            <ol class="breadcrumb">
                <li><a href="#">
                    <em class="fa fa-home"></em>
                </a></li>
                <li class="active">Главная</li>
            </ol>
        </div><!--/.row-->


        <div class="panel panel-default">
            <div class="panel-heading">
                Директория для сохранения документов
            </div>
            <div class="panel-body">

            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading" style="height: 40px;line-height: 20px;">Список выплатных документов</div>
            <div class="panel-body" style="display: block;">
                <table id="table" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                    <tr>
                        <th>UUID</th>
                        <th>Код банка</th>
                        <th>Название документа</th>
                        <th>Тип документа</th>
                        <th>Путь хранения</th>
                        <th>Статус</th>
                        <th>Операции</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>

    </div>	<!--/.main-->

    <div id="alert_success" class="alert alert-success fade in" hidden="hidden">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
            ×</button>
        <span class="glyphicon glyphicon-ok"></span> <strong>Успешно выполнено!</strong>
        <hr class="message-inner-separator">
        <p>
            Файл успешно сохранен в папке для загрузок!</p>
    </div>

    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script>

        $(document).ready(function() {
            $("#alert_success").hide();
            var path = $('#pathInput').val();
            var table = $('#table').DataTable({
                ajax: {
                    url: '/bank/getUploadFiles',
                    dataSrc: ''
                },
                language : {
                    "decimal":        "",
                    "emptyTable":     "Нет данных в таблице",
                    "info":           "Отображено от _START_ до _END_ из _TOTAL_ записей",
                    "infoEmpty":      "Отображено от 0 до 0 из 0 записей",
                    "infoFiltered":   "(filtered from _MAX_ total entries)",
                    "infoPostFix":    "",
                    "thousands":      ",",
                    "lengthMenu":     "Показывать _MENU_ записей",
                    "loadingRecords": "Загрузка...",
                    "processing":     "Обработка...",
                    "search":         "Поиск:",
                    "zeroRecords":    "Записей не найдено",
                    "paginate": {
                        "first":      "Первая",
                        "last":       "Последняя",
                        "next":       "Следующая",
                        "previous":   "Предыдущая"
                    },
                    "aria": {
                        "sortAscending":  ": activate to sort column ascending",
                        "sortDescending": ": activate to sort column descending"
                    }
                },

                columns: [
                    {data: 'uuid'},
                    {data: 'bank'},
                    {data: 'name'},
                    {data: 'typeDoc'},
                    {data: 'path'},
                    {data: 'status'},
                    {data: null}
                ],

                "columnDefs": [
                    {
                        "targets": -1,
                        "data": null,
                        "orderable": false,
                        "searchable": false,
                        "defaultContent": "<button style='border-radius: 25px;\n" +
                            "    font-weight: bold;\n" +
                            "    background-color: #fff;\n" +
                            "    border-color: #1d4d75;\n" +
                            "    color: #1d4d75;\n" +
                            "    border-width: 1px;\n" +
                            "    border-style: dashed;' class='btn btn-sm btn-success'><span class='fa fa-download'></span> СОХРАНИТЬ</button>"
                    }
                ]
            });

            $('#table tbody').on( 'click', 'button', function () {
                var data = table.row( $(this).parents('tr') ).data();
                window.location.href = 'download?uuid=' + data.uuid;
                $('#table').DataTable().ajax.reload();
                $("#alert_success").fadeTo(2000, 500).slideUp(500, function(){
                    $("#alert_success").slideUp(500);
                });
            } );
        });
    </script>
</body>
</html>