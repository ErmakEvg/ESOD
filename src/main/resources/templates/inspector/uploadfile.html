<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/login.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/insp.css}">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <title>ЕДИНАЯ СИСТЕМА ОБМЕНА ВЫПЛАТНЫМИ ДОКУМЕНТАМИ</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <script type="text/javascript">
        $(function() {
            $('button[type=submit]').click(function(e) {
                e.preventDefault();
                //Disable submit button
                $(this).prop('disabled',true);

                var form = document.forms[0];
                var formData = new FormData(form);

                // Ajax call for file uploaling
                var ajaxReq = $.ajax({
                    url : '/inspector/upload',
                    type : 'POST',
                    data : formData,
                    cache : false,
                    contentType : false,
                    processData : false,
                    xhr: function(){
                        //Get XmlHttpRequest object
                        var xhr = $.ajaxSettings.xhr() ;

                        //Set onprogress event handler
                        xhr.upload.onprogress = function(event){
                            var perc = Math.round((event.loaded / event.total) * 100);
                            $('#progressBar').text(perc + '%');
                            $('#progressBar').css('width',perc + '%');
                        };
                        return xhr ;
                    },
                    beforeSend: function( xhr ) {
                        //Reset alert message and progress bar
                        $('#alertMsg').text('');
                        $('#progressBar').text('');
                        $('#progressBar').css('width','0%');
                    }
                });

                // Called on success of file upload
                ajaxReq.done(function(msg) {
                    $('#alertMsg').text(msg);
                    $('input[type=file]').val('');
                    $('button[type=submit]').prop('disabled',false);
                    $('#alertMsg').css('color', 'green');
                    $('#table').DataTable().ajax.reload();

                });

                // Called on failure of file upload
                ajaxReq.fail(function(jqXHR) {
                    $('#alertMsg').text(jqXHR.responseText+'('+jqXHR.status+
                        ' - '+jqXHR.statusText+')');
                    $('button[type=submit]').prop('disabled',false);
                    $('#alertMsg').css('color', 'red');
                });
            });
        });
    </script>


</head>
<body>
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse"><span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span></button>
            <a class="navbar-brand" href="#"><span>ЕСО</span>ВД</a>

        </div>
    </div><!-- /.container-fluid -->
</nav>

    <div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
        <div class="profile-sidebar">
            <div class="profile-userpic">
                <img th:src="@{../img/man.png}" class="img-responsive" alt="">
            </div>
            <div class="profile-usertitle">
                <div class="profile-usertitle-name" th:utext="${user.getSurname() + ' ' + user.getFirstname()}"></div>
                <div class="profile-usertitle-status"><span class="indicator label-success"></span>Online</div>
            </div>
            <div class="clear"></div>
        </div>
        <div class="divider"></div>

        <ul class="nav menu">
            <li><a th:href="@{/inspector}"><em class="fa fa-home">&nbsp;</em> ГЛАВНАЯ</a></li>
            <li class="active"><a th:href="@{#}"><em class="fa fa-upload">&nbsp;</em> ЗАГРУЗКА ДОКУМЕНТА</a></li>
            <li><a href="charts.html"><em class="fa fa-list-alt">&nbsp;</em> ИСТОРИЯ</a></li>
            <li><a th:href="@{/logout}"><em class="fa fa-power-off">&nbsp;</em> ВЫХОД</a></li>
        </ul>
    </div><!--/.sidebar-->

    <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
        <div class="row">
            <ol class="breadcrumb">
                <li><a href="#">
                    <em class="fa fa-home"></em>
                </a></li>
                <li class="active">Главная</li>
            </ol>
        </div><!--/.row-->


        <div class="panel panel-default">
            <div class="panel-heading">
                Директория для считывания документов
            </div>
            <div class="panel-body">

            <form class="form-inline" method="POST" th:action="@{/inspector/upload}" th:object="${document}" enctype="multipart/form-data">
                <div class="form-group">
                    <input class="btn btn-default" type="file" th:field="*{file}" name="file" webkitdirectory>
                </div>
                <button style="font-weight: bold;
    background-color: #137f15;
    border-color: #286329;
    box-shadow: 0px 0px 14px -2px rgba(0,0,0,0.75);" class="btn btn-primary" type="submit"><span class="fa fa-cloud-upload"></span> Загрузить</button>

            </form>
                <br>
                <div class="progress" style="margin-bottom: 10px; height: 20px">
                    <div id="progressBar" class="progress-bar progress-bar-success" role="progressbar"
                         aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%</div>
                </div>

                <!-- Alert -->
                <div id="alertMsg" style="color: red;font-size: 18px;"></div>
            </div>
        </div>

        <div class="panel panel-info">
            <div class="panel-heading" style="height: 40px;line-height: 20px;">Список выплатных документов</div>
            <div class="panel-body" style="display: block;">
                <table id="table" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                    <tr>
                        <th>UUID</th>
                        <th>Код банка</th>
                        <th>Название документа</th>
                        <th>Тип документа</th>
                        <th>Путь хранения</th>
                        <th>Операции</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>

    </div>	<!--/.main-->




    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script>

        $(document).ready(function() {



                var path = $('#pathInput').val();
                $('#table').DataTable({
                    ajax: {
                        url: '/inspector/getUploadFiles',
                        dataSrc: ''
                    },
                    language : {
                        "decimal":        "",
                        "emptyTable":     "Нет данных в таблице",
                        "info":           "Отображено от _START_ до _END_ из _TOTAL_ записей",
                        "infoEmpty":      "Отображено от 0 до 0 из 0 записей",
                        "infoFiltered":   "(filtered from _MAX_ total entries)",
                        "infoPostFix":    "",
                        "thousands":      ",",
                        "lengthMenu":     "Показывать _MENU_ записей",
                        "loadingRecords": "Загрузка...",
                        "processing":     "Обработка...",
                        "search":         "Поиск:",
                        "zeroRecords":    "Записей не найдено",
                        "paginate": {
                            "first":      "Первая",
                            "last":       "Последняя",
                            "next":       "Следующая",
                            "previous":   "Предыдущая"
                        },
                        "aria": {
                            "sortAscending":  ": activate to sort column ascending",
                            "sortDescending": ": activate to sort column descending"
                         }
                    },

                   columns: [
                        {data: 'uuid'},
                        {data: 'bank'},
                        {data: 'name'},
                        {data: 'type.type'},
                        {data: 'path'},
                        {data: null}
                    ],

                    "columnDefs": [{
                        "targets": -1,
                        "data": null,
                        "orderable": false,
                        "searchable": false,
                        "defaultContent": "  <button style='    border-radius: 25px;\n" +
                            "    font-weight: bold;\n" +
                            "    background-color: #fff;\n" +
                            "    border-color: #1d4d75;\n" +
                            "    color: #1d4d75;\n" +
                            "    border-width: 1px;\n" +
                            "    border-style: dashed;' class='btn btn-sm btn-success'><span class='fa fa-pencil'></span> ПОДПИСАТЬ</button>"
                    }]
                });
            $('#table tbody').on( 'click', 'button', function () {

            } );

            });



    </script>
</body>
</html>